package com.old.time.activitys;import android.app.Activity;import android.content.Intent;import android.text.TextUtils;import android.view.View;import android.widget.Button;import android.widget.EditText;import com.old.time.R;import com.old.time.beans.LoginBean;import com.old.time.beans.UserInfoBean;import com.old.time.constants.Constant;import com.old.time.okhttps.Http;import com.old.time.okhttps.exception.ApiException;import com.old.time.okhttps.subscriber.CommonSubscriber;import com.old.time.okhttps.transformer.CommonTransformer;import com.old.time.utils.ActivityUtils;import com.old.time.utils.UserLocalInfoUtils;import com.old.time.utils.MapParams;import com.old.time.utils.StringUtils;import com.old.time.utils.UIHelper;public class UserLoginActivity extends BaseActivity {    private EditText input_phone, input_pass_word;    private Button btn_login;    /**     * 用户登录     *     * @param mContext     */    public static void startUserLoginActivity(Activity mContext) {        UserLocalInfoUtils.instance().setUserLogOut();        Intent intent = new Intent(mContext, UserLoginActivity.class);        ActivityUtils.startActivity(mContext, intent);    }    /**     * 登陆     */    private void loginUser() {        String phoneStr = input_phone.getText().toString().trim();        String codeStr = input_pass_word.getText().toString().trim();        if (TextUtils.isEmpty(phoneStr)) {            UIHelper.ToastMessage(mContext, "请输入手机号");            return;        }        if (TextUtils.isEmpty(codeStr)) {            UIHelper.ToastMessage(mContext, "请输入密码");            return;        }        if (!StringUtils.isMobileNO(phoneStr)) {            UIHelper.ToastMessage(mContext, "请输入正确的手机号");            return;        }        MapParams mMapParams = new MapParams();        mMapParams.putParams("usename", phoneStr);        mMapParams.putParams("password", codeStr);        Http.getHttpService().login(Constant.USER_LOGIN, mMapParams.getParamString())                .compose(new CommonTransformer<LoginBean>()).subscribe(new CommonSubscriber<LoginBean>(mContext, true) {            @Override            public void onNext(LoginBean loginBean) {                getDataFromNet();            }            @Override            protected void onError(ApiException e) {                super.onError(e);            }        });    }    @Override    protected void initView() {        input_phone = findViewById(R.id.input_phone);        input_pass_word = findViewById(R.id.input_pass_word);        btn_login = findViewById(R.id.btn_login);    }    @Override    protected void initEvent() {        super.initEvent();        btn_login.setOnClickListener(this);        findViewById(R.id.tv_pass_word).setOnClickListener(this);        findViewById(R.id.tv_user_register).setOnClickListener(this);    }    @Override    public void onClick(View view) {        super.onClick(view);        switch (view.getId()) {            case R.id.btn_login:                loginUser();                break;            case R.id.tv_user_register:                startUserRegister("0");                break;            case R.id.tv_pass_word:                startUserRegister("1");                break;        }    }    private void getDataFromNet() {        MapParams mMapParams = new MapParams();        mMapParams.putParams("userid", "d01bbb7c-9f8e-4669-9bbb-7c9f8e1669f0");        mMapParams.putParams("current_userid", "d01bbb7c-9f8e-4669-9bbb-7c9f8e1669f0");        Http.getHttpService().getUserInfo(Constant.GET_USER_INFO, mMapParams.getParamString()).compose(new CommonTransformer<UserInfoBean>()).subscribe(new CommonSubscriber<UserInfoBean>(mContext) {            @Override            public void onNext(UserInfoBean mUserInfoBean) {                UserLocalInfoUtils.instance().setmUserInfoBean(mUserInfoBean);                MainActivity.startMainActivity(mContext);            }            @Override            protected void onError(ApiException e) {                super.onError(e);            }        });    }    /**     * 进入注册页面     *     * @param mRegisterTag     */    private void startUserRegister(String mRegisterTag) {        String phoneStr = input_phone.getText().toString().trim();        UserRegisterActivity.startUserRegisterActivity(mContext, mRegisterTag, phoneStr);    }    @Override    protected int getLayoutID() {        return R.layout.activity_login;    }}